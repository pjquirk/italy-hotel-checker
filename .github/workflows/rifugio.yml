name: Checking Rifugio Availability

on:
  workflow_dispatch:
    inputs:
      date:
        description: 'Date to check availability (YYYY-MM-DD)'
        required: false
        default: '2026-07-07'
  schedule:
    - cron: '35 * * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        hostels: [
          { date: "2026-09-10", name: "Rifugio Fodara Vedla", url: "https://www.fodara.it/en#YxKQED1yBxB__", id: 12869 },
          { date: "2026-09-10", name: "Rifugio Peder√º", url: "https://www.pederue.it/en#Y7D0a11V", id: 10716 },
          { date: "2026-09-10", name: "Rifugio Fanes", url: "https://www.rifugiofanes.com/en/booking.htm", id: 13308 },
          { date: "2026-09-10", name: "Rifugio Lavarella", url: "https://lavarella.it/en/book-online", id: 13004 },
        ]
        guests: [
          { count: 1, param: "18" },
          { count: 2, param: "18%2C18" },
        ]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Check for an open spot on given date
        id: check_availability
        run: |
          ./script/check-availability.sh \
            --date "${{ github.event.inputs.date || matrix.hostels.DATE }}" \
            --hostel-id "${{ matrix.hostels.id }}" \
            --hostel-name "${{ matrix.hostels.name }}" \
            --guests-count "${{ matrix.guests.count }}" \
            --guests-param "${{ matrix.guests.param }}"

      - name: Notify if the spot is available
        uses: appricos/pushinator-action@v1
        if: success() && steps.check_availability.outputs.available == 'true'
        with:
          apiToken: ${{ secrets.PUSHINATOR_API_TOKEN }}
          channelId: ${{ secrets.PUSHINATOR_CHANNEL_ID }}
          notification: ${{ steps.check_availability.outputs.message }}

